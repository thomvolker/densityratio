<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Fast, flexible and user-friendly functionality to directly estimate the ratio 
  of two probability distributions from samples from these distributions without 
  estimating the densities separately. Estimated density ratios can, among other
  things, be used for prediction, outlier detection, change-point detection 
  in time-series, importance weighting under domain adaptation (i.e., sample 
  selection bias) and evaluation of synthetic data utility. The rationale behind 
  these use-cases is that differences between two data distributions can be 
  captured in the ratio their density ratio, which is estimated over the entire 
  multivariate space of the data.
    Computationally intensive code is executed in `C++` using `Rcpp` and 
  `RcppArmadillo`. The package provides good default hyperparameters that can be 
  optimized in cross-validation (we do recommend understanding those parameters 
  before using `densityratio` in practice). Multiple density ratio estimation 
  methods are implemented, such as unconstrained least-squares importance 
  fitting (`ulsif()`), Kullback-Leibler importance estimation procedure 
  (`kliep()`), spectral density ratio estimation (`spectral()`), and least-squares 
  heterodistributional subspace search (`lhss()`).">
<title>Distribution Comparison Through Density Ratio Estimation • densityratio</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Distribution Comparison Through Density Ratio Estimation">
<meta property="og:description" content="Fast, flexible and user-friendly functionality to directly estimate the ratio 
  of two probability distributions from samples from these distributions without 
  estimating the densities separately. Estimated density ratios can, among other
  things, be used for prediction, outlier detection, change-point detection 
  in time-series, importance weighting under domain adaptation (i.e., sample 
  selection bias) and evaluation of synthetic data utility. The rationale behind 
  these use-cases is that differences between two data distributions can be 
  captured in the ratio their density ratio, which is estimated over the entire 
  multivariate space of the data.
    Computationally intensive code is executed in `C++` using `Rcpp` and 
  `RcppArmadillo`. The package provides good default hyperparameters that can be 
  optimized in cross-validation (we do recommend understanding those parameters 
  before using `densityratio` in practice). Multiple density ratio estimation 
  methods are implemented, such as unconstrained least-squares importance 
  fitting (`ulsif()`), Kullback-Leibler importance estimation procedure 
  (`kliep()`), spectral density ratio estimation (`spectral()`), and least-squares 
  heterodistributional subspace search (`lhss()`).">
<meta property="og:image" content="https://thomvolker.github.io/densityratio/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">densityratio</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/getting-started.html">Introduction: Density ratio estimation for covariate shift</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="densityratio-">densityratio <a class="anchor" aria-label="anchor" href="#densityratio-"></a>
</h1>
</div>
<!-- badges: start -->

<!-- badges: end -->
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This package provides functionality to directly estimate a density ratio <span class="math display">$$r(x) = \frac{p_\text{nu}(x)}{p_{\text{de}}(x)},$$</span> without estimating the numerator and denominator density separately. Density ratio estimation serves many purposes, for example, prediction, outlier detection, change-point detection in time-series, importance weighting under domain adaptation (i.e., sample selection bias) and evaluation of synthetic data utility. The key idea is that differences between data distributions can be captured in their density ratio, which is estimated over the entire multivariate space of the data. Subsequently, the density ratio values can be used to summarize the dissimilarity between the two distributions in a discrepancy measure.</p>
<p><img src="reference/figures/README-densities-1.png" width="15cm" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h3>
<ul>
<li>
<strong>Fast</strong>: Computationally intensive code is executed in <code>C++</code> using <code>Rcpp</code> and <code>RcppArmadillo</code>.</li>
<li>
<strong>Automatic</strong>: Good default hyperparameters that can be optimized in cross-validation (we do recommend understanding those parameters before using <code>densityratio</code> in practice).</li>
<li>
<strong>Complete</strong>: Several density ratio estimation methods, such as unconstrained least-squares importance fitting (<code><a href="reference/ulsif.html">ulsif()</a></code>), Kullback-Leibler importance estimation procedure (<code><a href="reference/kliep.html">kliep()</a></code>), ratio of estimated densities (<code><a href="reference/naive.html">naive()</a></code>), ratio of estimated densities after dimension reduction (<code>naivesubspace()</code>), and least-squares heterodistributional subspace search (<code><a href="reference/lhss.html">lhss()</a></code>; experimental).</li>
<li>
<strong>User-friendly</strong>: Simple user interface, default <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>, <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> and <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> functions for all density ratio estimation methods; built-in data sets for quick testing.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of <code>densityratio</code> from <a href="https://r-universe.dev/search" class="external-link">R-universe</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'densityratio'</span>, repos <span class="op">=</span> <span class="st">'https://thomvolker.r-universe.dev'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>The package contains several functions to estimate the density ratio between the numerator data and the denominator data. To illustrate the functionality, we make use of the in-built simulated data sets <code>numerator_data</code> and <code>denominator_data</code>, that both consist of the same five variables.</p>
<div class="section level3">
<h3 id="minimal-example">Minimal example<a class="anchor" aria-label="anchor" href="#minimal-example"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">densityratio</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">numerator_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 5</span></span>
<span><span class="co">#&gt;   x1    x2         x3     x4     x5</span></span>
<span><span class="co">#&gt;   &lt;fct&gt; &lt;fct&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 A     G1    -0.0299  0.967 -1.26 </span></span>
<span><span class="co">#&gt; 2 C     G1     2.29   -0.475  2.40 </span></span>
<span><span class="co">#&gt; 3 A     G1     1.37    0.577 -0.172</span></span>
<span><span class="co">#&gt; 4 B     G2     1.44   -0.193 -0.708</span></span>
<span><span class="co">#&gt; 5 A     G1     1.01    2.23   2.01 </span></span>
<span><span class="co">#&gt; 6 C     G2     1.83    0.762  3.71</span></span>
<span></span>
<span><span class="va">fit</span>  <span class="op">&lt;-</span> <span class="fu"><a href="reference/ulsif.html">ulsif</a></span><span class="op">(</span></span>
<span>  df_numerator <span class="op">=</span> <span class="va">numerator_data</span><span class="op">$</span><span class="va">x5</span>, </span>
<span>  df_denominator <span class="op">=</span> <span class="va">denominator_data</span><span class="op">$</span><span class="va">x5</span>, </span>
<span>  nsigma <span class="op">=</span> <span class="fl">5</span>, </span>
<span>  nlambda <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ulsif"</span></span></code></pre></div>
<p>We can ask for the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> of the estimated density ratio object, that contains the optimal kernel weights (optimized using cross-validation) and a measure of discrepancy between the numerator and denominator densities.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ulsif(df_numerator = numerator_data$x5, df_denominator = denominator_data$x5,     nsigma = 5, nlambda = 5)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Kernel Information:</span></span>
<span><span class="co">#&gt;   Kernel type: Gaussian with L2 norm distances</span></span>
<span><span class="co">#&gt;   Number of kernels: 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimal sigma: 0.3726142</span></span>
<span><span class="co">#&gt; Optimal lambda: 0.03162278</span></span>
<span><span class="co">#&gt; Optimal kernel weights: num [1:201] 0.43926 0.01016 0.00407 0.01563 0.01503 ...</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Pearson divergence between P(nu) and P(de): 0.2801</span></span>
<span><span class="co">#&gt; For a two-sample homogeneity test, use 'summary(x, test = TRUE)'.</span></span></code></pre></div>
<p>To formally evaluate whether the numerator and denominator densities differ significantly, you can perform a two-sample homogeneity test as follows.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, test <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ulsif(df_numerator = numerator_data$x5, df_denominator = denominator_data$x5,     nsigma = 5, nlambda = 5)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Kernel Information:</span></span>
<span><span class="co">#&gt;   Kernel type: Gaussian with L2 norm distances</span></span>
<span><span class="co">#&gt;   Number of kernels: 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimal sigma: 0.3726142</span></span>
<span><span class="co">#&gt; Optimal lambda: 0.03162278</span></span>
<span><span class="co">#&gt; Optimal kernel weights: num [1:201] 0.43926 0.01016 0.00407 0.01563 0.01503 ...</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Pearson divergence between P(nu) and P(de): 0.2801</span></span>
<span><span class="co">#&gt; Pr(P(nu)=P(de)) &lt; .001</span></span>
<span><span class="co">#&gt; Bonferroni-corrected for testing with r(x) = P(nu)/P(de) AND r*(x) = P(de)/P(nu).</span></span></code></pre></div>
<p>The probability that numerator and denominator samples share a common data generating mechanism is very small.</p>
<p>The <code>ulsif</code>-object also contains the (hyper-)parameters used in estimating the density ratio, such as the centers used in constructing the Gaussian kernels (<code>fit$centers</code>), the different bandwidth parameters (<code>fit$sigma</code>) and the regularization parameters (<code>fit$lambda</code>). Using these variables, we can obtain the estimated density ratio using <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># obtain predictions for the numerator samples</span></span>
<span></span>
<span><span class="va">newx5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>, to <span class="op">=</span> <span class="fl">6</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">pred</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata <span class="op">=</span> <span class="va">newx5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">newx5</span>, y <span class="op">=</span> <span class="va">pred</span>, col <span class="op">=</span> <span class="st">"ulsif estimates"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"True density ratio"</span><span class="op">)</span>, </span>
<span>                fun <span class="op">=</span> <span class="va">dratio</span>, </span>
<span>                args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.4</span>, dif <span class="op">=</span> <span class="fl">3</span>, mu <span class="op">=</span> <span class="fl">3</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#de0277"</span>, <span class="st">"purple"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>        text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot-univ-1.png" width="15cm" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="scaling">Scaling<a class="anchor" aria-label="anchor" href="#scaling"></a>
</h3>
<p>By default, all functions in the <code>densityratio</code> package standardize the data to the numerator means and standard deviations. This is done to ensure that the importance of each variable in the kernel estimates is not dependent on the scale of the data. By setting <code>scale = "denominator"</code> one can scale the data to the means and standard deviations of the denominator data, and by setting <code>scale = FALSE</code> the data remains on the original scale.</p>
</div>
<div class="section level3">
<h3 id="categorical-data">Categorical data<a class="anchor" aria-label="anchor" href="#categorical-data"></a>
</h3>
<p>All of the functions in the <code>densityratio</code> package accept categorical variables types. However, note that internally, these variables are one-hot encoded, which can lead to a high-dimensional feature-space.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">numerator_data</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A   B   C </span></span>
<span><span class="co">#&gt; 351 339 310</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">denominator_data</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A   B   C </span></span>
<span><span class="co">#&gt; 252 232 516</span></span>
<span></span>
<span><span class="va">fit_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ulsif.html">ulsif</a></span><span class="op">(</span></span>
<span>  df_numerator <span class="op">=</span> <span class="va">numerator_data</span><span class="op">$</span><span class="va">x1</span>, </span>
<span>  df_denominator <span class="op">=</span> <span class="va">denominator_data</span><span class="op">$</span><span class="va">x1</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in check.sigma(nsigma, sigma_quantile, sigma, dist_nu): There are duplicate values in 'sigma', only the unique values are used.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_cat</span><span class="op">)</span> <span class="op">~</span> <span class="va">numerator_data</span><span class="op">$</span><span class="va">x1</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">unique</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   numerator_data$x1 predict(fit_cat)</span></span>
<span><span class="co">#&gt; 1                 A        1.3005360</span></span>
<span><span class="co">#&gt; 2                 B        1.3574809</span></span>
<span><span class="co">#&gt; 3                 C        0.6379142</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">numerator_data</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">denominator_data</span><span class="op">$</span><span class="va">x1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         A         B         C </span></span>
<span><span class="co">#&gt; 1.3928571 1.4612069 0.6007752</span></span></code></pre></div>
<p>This transformation can give a reasonable estimate of the ratio of proportions in the different data sets (although there is some regularization applied such that the estimated odds are closer to one than seen in the real data).</p>
</div>
<div class="section level3">
<h3 id="full-data-example">Full data example<a class="anchor" aria-label="anchor" href="#full-data-example"></a>
</h3>
<p>After transforming all variables to numeric variables, it is possible to calculate the density ratio over the entire multivariate space of the data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ulsif.html">ulsif</a></span><span class="op">(</span></span>
<span>  df_numerator <span class="op">=</span> <span class="va">numerator_data</span>,</span>
<span>  df_denominator <span class="op">=</span> <span class="va">denominator_data</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_all</span>, test <span class="op">=</span> <span class="cn">TRUE</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ulsif(df_numerator = numerator_data, df_denominator = denominator_data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Kernel Information:</span></span>
<span><span class="co">#&gt;   Kernel type: Gaussian with L2 norm distances</span></span>
<span><span class="co">#&gt;   Number of kernels: 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimal sigma: 1.065369</span></span>
<span><span class="co">#&gt; Optimal lambda: 0.1623777</span></span>
<span><span class="co">#&gt; Optimal kernel weights: num [1:201] 0.5691 0.1511 0.0959 0.0118 0.0149 ...</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; Pearson divergence between P(nu) and P(de): 0.4629</span></span>
<span><span class="co">#&gt; Pr(P(nu)=P(de)) &lt; .001</span></span>
<span><span class="co">#&gt; Bonferroni-corrected for testing with r(x) = P(nu)/P(de) AND r*(x) = P(de)/P(nu).</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="other-density-ratio-estimation-functions">Other density ratio estimation functions<a class="anchor" aria-label="anchor" href="#other-density-ratio-estimation-functions"></a>
</h3>
<p>Besides <code><a href="reference/ulsif.html">ulsif()</a></code>, the package contains several other functions to estimate a density ratio.</p>
<ul>
<li>
<code><a href="reference/naive.html">naive()</a></code> estimates the numerator and denominator densities separately, and subsequently takes there ratio.</li>
<li>
<code><a href="reference/kliep.html">kliep()</a></code> estimates the density ratio directly through the Kullback-Leibler importance estimation procedure. <!-- * `kmm()` estimates the density ratio for the denominator sample points only through kernel mean matching.  -->
</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">fit_naive</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/naive.html">naive</a></span><span class="op">(</span></span>
<span>  df_numerator <span class="op">=</span> <span class="va">numerator_data</span><span class="op">$</span><span class="va">x5</span>, </span>
<span>  df_denominator <span class="op">=</span> <span class="va">denominator_data</span><span class="op">$</span><span class="va">x5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_kliep</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/kliep.html">kliep</a></span><span class="op">(</span></span>
<span>  df_numerator <span class="op">=</span> <span class="va">numerator_data</span><span class="op">$</span><span class="va">x5</span>, </span>
<span>  df_denominator <span class="op">=</span> <span class="va">denominator_data</span><span class="op">$</span><span class="va">x5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">pred_naive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_naive</span>, newdata <span class="op">=</span> <span class="va">newx5</span><span class="op">)</span></span>
<span><span class="va">pred_kliep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_kliep</span>, newdata <span class="op">=</span> <span class="va">newx5</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">newx5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">pred</span>, col <span class="op">=</span> <span class="st">"ulsif estimates"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">pred_naive</span>, col <span class="op">=</span> <span class="st">"naive estimates"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">pred_kliep</span>, col <span class="op">=</span> <span class="st">"kliep estimates"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, col <span class="op">=</span> <span class="st">"True density ratio"</span><span class="op">)</span>, </span>
<span>                fun <span class="op">=</span> <span class="va">dratio</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.4</span>, dif <span class="op">=</span> <span class="fl">3</span>, mu <span class="op">=</span> <span class="fl">3</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pink"</span>, <span class="st">"#512970"</span>,<span class="st">"#de0277"</span>, <span class="st">"purple"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>        text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot-methods-1.png" width="15cm" style="display: block; margin: auto;"></p>
<p>The figure directly shows that <code><a href="reference/ulsif.html">ulsif()</a></code> and <code><a href="reference/kliep.html">kliep()</a></code> come rather close to the true density ratio function in this example, and outperform the <code><a href="reference/naive.html">naive()</a></code> solution.</p>
</div>
</div>
<div class="section level2">
<h2 id="contributions">Contributions<a class="anchor" aria-label="anchor" href="#contributions"></a>
</h2>
<p>This package is still in development, and I’ll be happy to take feedback and suggestions. Please submit these through <a href="https://github.com/thomvolker/densityratio/issues" class="external-link">GitHub Issues</a>.</p>
</div>
<div class="section level2">
<h2 id="resources">Resources<a class="anchor" aria-label="anchor" href="#resources"></a>
</h2>
<p><strong>Books</strong></p>
<ul>
<li>General information about the density ratio estimation framework: Sugiyama, Suzuki and Kanamori (2012). <a href="https://www.cambridge.org/core/books/density-ratio-estimation-in-machine-learning/BCBEA6AEAADD66569B1E85DDDEAA7648" class="external-link">Density Ratio Estimation in Machine Learning</a>
</li>
</ul>
<p><strong>Papers</strong></p>
<ul>
<li>Density ratio estimation for the evaluation of the utility of synthetic data: Volker, De Wolf and Van Kesteren (2023). <a href="https://unece.org/statistics/documents/2023/08/working-documents/assessing-utility-synthetic-data-density-ratio" class="external-link">Assessing the utility of synthetic data: A density ratio perspective</a>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="how-to-cite">How to cite<a class="anchor" aria-label="anchor" href="#how-to-cite"></a>
</h2>
<p>Volker, T.B. (2023). densityratio: Distribution comparison through density ratio estimation. <a href="https://doi.org/10.5281/zenodo.8307819" class="external-link uri">https://doi.org/10.5281/zenodo.8307819</a></p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing densityratio</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Thom Volker <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0002-2408-7820" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/thomvolker/densityratio/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/thomvolker/densityratio/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://thomvolker.r-universe.dev/densityratio" class="external-link"><img src="https://thomvolker.r-universe.dev/badges/densityratio" alt="densityratio status badge"></a></li>
<li><a href="https://zenodo.org/badge/latestdoi/613441108" class="external-link"><img src="https://zenodo.org/badge/613441108.svg" alt="DOI"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Thom Volker.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
