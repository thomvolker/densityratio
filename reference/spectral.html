<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Spectral series based density ratio estimation — spectral • densityratio</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spectral series based density ratio estimation — spectral"><meta name="description" content="Spectral series based density ratio estimation"><meta property="og:description" content="Spectral series based density ratio estimation"><meta property="og:image" content="https://thomvolker.github.io/densityratio/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">densityratio</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/densityratio.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/covariate-shift.html">Covariate shift adjustment</a></li>
    <li><a class="dropdown-item" href="../articles/high-dim-testing.html">High dimensional two-sample testing</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/thomvolker/densityratio/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Spectral series based density ratio estimation</h1>
      <small class="dont-index">Source: <a href="https://github.com/thomvolker/densityratio/blob/v0.2.1/R/spectral.R" class="external-link"><code>R/spectral.R</code></a></small>
      <div class="d-none name"><code>spectral.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Spectral series based density ratio estimation</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">spectral</span><span class="op">(</span></span>
<span>  <span class="va">df_numerator</span>,</span>
<span>  <span class="va">df_denominator</span>,</span>
<span>  m <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"numerator"</span>,</span>
<span>  nsigma <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  sigma_quantile <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sigma <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ncenters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cv <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  nfold <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  nthreads <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  progressbar <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df-numerator">df_numerator<a class="anchor" aria-label="anchor" href="#arg-df-numerator"></a></dt>
<dd><p><code>data.frame</code> with exclusively numeric variables with
the numerator samples</p></dd>


<dt id="arg-df-denominator">df_denominator<a class="anchor" aria-label="anchor" href="#arg-df-denominator"></a></dt>
<dd><p><code>data.frame</code> with exclusively numeric variables
with the denominator samples (must have the same variables as
<code>df_denominator</code>)</p></dd>


<dt id="arg-m">m<a class="anchor" aria-label="anchor" href="#arg-m"></a></dt>
<dd><p>Integer vector indicating the number of eigenvectors to use in the
spectral series expansion. Defaults to 50 evenly spaced values between 1 and
the number of denominator samples (or the largest number of samples that can
be used as centers in the cross-validation scheme).</p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p><code>"numerator"</code>, <code>"denominator"</code>, or <code>NULL</code>,
indicating whether to standardize each numeric variable according to the
numerator means and standard deviations, the denominator means and standard
deviations, or apply no standardization at all.</p></dd>


<dt id="arg-nsigma">nsigma<a class="anchor" aria-label="anchor" href="#arg-nsigma"></a></dt>
<dd><p>Integer indicating the number of sigma values (bandwidth
parameter of the Gaussian kernel gram matrix) to use in cross-validation.</p></dd>


<dt id="arg-sigma-quantile">sigma_quantile<a class="anchor" aria-label="anchor" href="#arg-sigma-quantile"></a></dt>
<dd><p><code>NULL</code> or numeric vector with probabilities to
calculate the quantiles of the distance matrix to obtain sigma values. If
<code>NULL</code>, <code>nsigma</code> values between <code>0.05</code> and <code>0.95</code> are
used.</p></dd>


<dt id="arg-sigma">sigma<a class="anchor" aria-label="anchor" href="#arg-sigma"></a></dt>
<dd><p><code>NULL</code> or a scalar value to determine the bandwidth of the
Gaussian kernel gram matrix. If <code>NULL</code>, <code>nsigma</code> values between
<code>0.05</code> and <code>0.95</code> are used.</p></dd>


<dt id="arg-ncenters">ncenters<a class="anchor" aria-label="anchor" href="#arg-ncenters"></a></dt>
<dd><p>integer If smaller than the number of denominator observations,
an approximation to the eigenvector expansion based on only ncenters samples
is performed, instead of the full expansion. This can be useful for large
datasets. Defaults to <code>NULL</code>, such that all denominator samples are used.</p></dd>


<dt id="arg-cv">cv<a class="anchor" aria-label="anchor" href="#arg-cv"></a></dt>
<dd><p>logical indicating whether to use cross-validation to determine the
optimal sigma value and the optimal number of eigenvectors.</p></dd>


<dt id="arg-nfold">nfold<a class="anchor" aria-label="anchor" href="#arg-nfold"></a></dt>
<dd><p>Integer indicating the number of folds to use in the
cross-validation scheme. If <code>cv</code> is <code>FALSE</code>, this parameter is
ignored.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>logical indicating whether to use parallel processing in the
cross-validation scheme.</p></dd>


<dt id="arg-nthreads">nthreads<a class="anchor" aria-label="anchor" href="#arg-nthreads"></a></dt>
<dd><p><code>NULL</code> or integer indicating the number of threads to
use for parallel processing. If parallel processing is enabled, it defaults
to the number of available threads minus one.</p></dd>


<dt id="arg-progressbar">progressbar<a class="anchor" aria-label="anchor" href="#arg-progressbar"></a></dt>
<dd><p>Logical indicating whether or not to display a progressbar.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>spectral</code>-object, containing all information to calculate the
density ratio using optimal sigma and optimal spectral series expansion.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Izbicki, R., Lee, A. &amp; Schafer, C. (2014). High-Dimensional
Density Ratio Estimation with Extensions to Approximate Likelihood Computation.
<i>Proceedings of Machine Learning Research</i> 33, 420-429. Available from
<a href="https://proceedings.mlr.press/v33/izbicki14.html" class="external-link">https://proceedings.mlr.press/v33/izbicki14.html</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Fit model</span></span></span>
<span class="r-in"><span><span class="va">dr</span> <span class="op">&lt;-</span> <span class="fu">spectral</span><span class="op">(</span><span class="va">numerator_small</span>, <span class="va">denominator_small</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Inspect model object</span></span></span>
<span class="r-in"><span><span class="va">dr</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> spectral(df_numerator = numerator_small, df_denominator = denominator_small)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel Information:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Kernel type: Gaussian with L2 norm distances</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of kernels: 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sigma: num [1:10] 0.807 1.191 1.455 1.688 1.913 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Subspace dimension (J): num [1:50] 1 2 4 6 8 10 11 13 15 17 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimal sigma: 3.582214</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimal subspace: 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimal kernel weights (cv): num [1:8] 1.0045 -0.6689 -0.0938 0.8499 0.0228 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-in"><span><span class="co"># Obtain summary of model object</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dr</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> spectral(df_numerator = numerator_small, df_denominator = denominator_small)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel Information:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Kernel type: Gaussian with L2 norm distances</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of kernels: 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimal sigma: 3.582214</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimal subspace: 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimal kernel weights (cv): num [1:8] 1.0045 -0.6689 -0.0938 0.8499 0.0228 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pearson divergence between P(nu) and P(de): 0.8063</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> For a two-sample homogeneity test, use 'summary(x, test = TRUE)'.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># Plot model object</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dr</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Negative estimated density ratios for 22 observation(s) converted to 0.01 before applying logarithmic transformation</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span>
<span class="r-plt img"><img src="spectral-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># Plot density ratio for each variable individually</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_univariate.html">plot_univariate</a></span><span class="op">(</span><span class="va">dr</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Negative estimated density ratios for 22 observation(s) converted to 0.01 before applying logarithmic transformation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-plt img"><img src="spectral-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-plt img"><img src="spectral-3.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[3]]</span>
<span class="r-plt img"><img src="spectral-4.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># Plot density ratio for each pair of variables</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_bivariate.html">plot_bivariate</a></span><span class="op">(</span><span class="va">dr</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Negative estimated density ratios for 22 observation(s) converted to 0.01 before applying logarithmic transformation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-plt img"><img src="spectral-5.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-plt img"><img src="spectral-6.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[3]]</span>
<span class="r-plt img"><img src="spectral-7.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># Predict density ratio and inspect first 6 predictions</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">dr</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> , , 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 2.8779372</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 3.8658889</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 3.7674156</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] 4.8603842</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,] 0.6970124</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,] 2.1671079</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># Fit model with custom parameters</span></span></span>
<span class="r-in"><span><span class="fu">spectral</span><span class="op">(</span><span class="va">numerator_small</span>, <span class="va">denominator_small</span>, sigma <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> spectral(df_numerator = numerator_small, df_denominator = denominator_small,     sigma = 2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel Information:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Kernel type: Gaussian with L2 norm distances</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of kernels: 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sigma: num 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Subspace dimension (J): num [1:50] 1 2 4 6 8 10 11 13 15 17 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimal sigma: 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimal subspace: 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimal kernel weights (cv): num [1:4] 0.98 -0.8324 -0.0561 0.6471</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thom Volker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

